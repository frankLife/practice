<!DOCTYPE html>
<html lang="en">
<head>
<title>chapetr7</title>
</head>
<body>
<canvas width="960" height="500"></canvas>
<script>
(function(){
  var canvas = document.getElementsByTagName('canvas')[0];
  var ctx = canvas.getContext('2d');
  var imgMap = {};
  imgMap['alien'] = new Image();
  imgMap['alien'].src = "./spaceRes/alien.png";
  imgMap['missile'] = new Image();
  imgMap['missile'].src = "./spaceRes/missile.png";
  imgMap['player'] = new Image();
  imgMap['player'].src = "./spaceRes/player.png";
  var audioType = supportType();
  var audioMap = {};
  audioMap['explode'] = document.createElement('audio');
  audioMap['explode'].src = "./spaceRes/explode" + audioType;

  function supportType(){
    var returnExtension = '';
    var audioForType = document.createElement('audio');    
    var checkTypeArray = ['ogg','wav','mp3'];
    for(var i = 0,len = checkTypeArray.length;i<len;i++) {
      var itemType = checkTypeArray[i];
      if(audio.canPlayType('audio/'+ itemType) == 'probably' ||audio.canPlayType('audio/'+itemType) == 'maybe' ) {
        returnExtension = 'audio/' + itemType
        break;
      }
    }

    return returnExtension;
  }


  function itemsLoad(callback){
    this.count = 0;
    this.start = null;
    this.callback = callback;
    this.sourceEl = [];
  }
  itemsLoad.prototype.loadTrigger = function(el){
    this.count--;
    for(var i = 0,len = this.sourceEl.length;i<len;i++) {
      if(this.sourceEl[i]['el'] == el) {
        this.sourceEl[i]['isLoaded'] = true;
        break;
      }
    }
    if(i == len ){
      throw '加载资源出错';
    }
    if(this.count == 0) {
      this.callback();
    }
  }
  itemsLoad.prototype.loadAdd = function(el){
    this.sourceEl.push({el:el,isLoaded:false});
    this.count++;
  }
  var loader = new itemsLoad(function(){

  });

})()
</script>
</body>
</html>